
<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" type="image/png" href="/img/sand2.png">
  <link rel="shortcut icon" type="image/x-icon" href="/img/sand2.png">
  <meta property="og:image" content="https://assets-cdn.github.com/images/modules/open_graph/github-octocat.png">
  
  <link rel="stylesheet" href="/css/style.css?v=1.3"> 
  <link href="//vjs.zencdn.net/6.7/video-js.min.css" rel="stylesheet">
  <script src="//vjs.zencdn.net/6.7/video.min.js"></script>
  
  <title>Declaration Merging | 小沙丘的网络漫游记</title>
 <meta name="description" content="" >

 <!-- 百度统计 -->
 <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?eafa0040e1ab3bed28ce82ef03de6e01";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
  
<link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css"></head>
<body>
  
  <script>
      if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)){
        document.body.classList.add('mobile');            
      } else{
        document.body.classList.add('pc');
        document.getElementsByTagName("html")[0].style.fontSize="62.5%";
      }
      var u = navigator.userAgent;
var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
if(isiOS){
  document.body.classList.add('ios');
  document.getElementsByTagName("html")[0].style.fontSize="65%";
           
}
    </script>

  <div class="container">
<!-- 用于文章页面的顶部，提供返回主页和主题页的按键 -->
<!-- 头部开始 -->

<div id="header">
    <p>小沙丘的网络漫游记
      <span> » 
        <a href="/home/">首页</a>
      </span>
      
      <span> » 
          <a href="/tags/Typescript/">
            Typescript
          </a>
      </span>
      
    </p>
</div>

<!-- 头部结束 -->



<!-- 分类组件，放置于文章页面的顶部，提供上(或下)一篇导航按键。 -->
<div class="asset-nav">
    <div class="entry-categories">
      <p>主题：
        <span> 
            <a href="/tags/Typescript/">
              Typescript
            </a>
        </span>
      </p>
    </div>
    <div class="entry-location-mobile">
        <span>
            
            <a href="/2018/05/25/online-ts-17/">
            &#8676;
            </a>
        </span>
        <span>
            
            <a href="/2018/05/25/online-ts-19/">
              &#8677;
            </a>
        </span>
    </div>
    <div class="entry-location">
        <P>上一篇：
                <a href="/2018/05/25/online-ts-17/">
                    Module Resolution
                </a>
        </P>
        <P>下一篇：

                <a href="/2018/05/25/online-ts-19/">
                    JSX
                </a>
        </P>
    </div>
</div>

<div class="post">
<div class="title-post">
<h1>Declaration Merging</h1>
<div class="post-meta">
  <p>作者： Lian</p>
  <p>日期：
    2018年05月25日 18:05
  </p>
</div>
</div>



  
  <div class="page">
      <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Some of the unique concepts in TypeScript describe the shape of JavaScript objects at the type level.<br>One example that is especially unique to TypeScript is the concept of ‘declaration merging’.<br>Understanding this concept will give you an advantage when working with existing JavaScript.<br>It also opens the door to more advanced abstraction concepts.</p>
<p>For the purposes of this article, “declaration merging” means that the compiler merges two separate declarations declared with the same name into a single definition.<br>This merged definition has the features of both of the original declarations.<br>Any number of declarations can be merged; it’s not limited to just two declarations.</p>
<h1 id="Basic-Concepts"><a href="#Basic-Concepts" class="headerlink" title="Basic Concepts"></a>Basic Concepts</h1><p>In TypeScript, a declaration creates entities in at least one of three groups: namespace, type, or value.<br>Namespace-creating declarations create a namespace, which contains names that are accessed using a dotted notation.<br>Type-creating declarations do just that: they create a type that is visible with the declared shape and bound to the given name.<br>Lastly, value-creating declarations create values that are visible in the output JavaScript.</p>
<table>
<thead>
<tr>
<th>Declaration Type</th>
<th style="text-align:center">Namespace</th>
<th style="text-align:center">Type</th>
<th style="text-align:center">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Namespace</td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>Class</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>Enum</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>Interface</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>Type Alias</td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td>Function</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
</tr>
<tr>
<td>Variable</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">X</td>
</tr>
</tbody>
</table>
<p>Understanding what is created with each declaration will help you understand what is merged when you perform a declaration merge.</p>
<h1 id="Merging-Interfaces"><a href="#Merging-Interfaces" class="headerlink" title="Merging Interfaces"></a>Merging Interfaces</h1><p>The simplest, and perhaps most common, type of declaration merging is interface merging.<br>At the most basic level, the merge mechanically joins the members of both declarations into a single interface with the same name.</p>
<pre class=" language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Box</span> <span class="token punctuation">{</span>
    height<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
    width<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Box</span> <span class="token punctuation">{</span>
    scale<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> box<span class="token punctuation">:</span> Box <span class="token operator">=</span> <span class="token punctuation">{</span>height<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> scale<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Non-function members of the interfaces should be unique.<br>If they are not unique, they must be of the same type.<br>The compiler will issue an error if the interfaces both declare a non-function member of the same name, but of different types.</p>
<p>For function members, each function member of the same name is treated as describing an overload of the same function.<br>Of note, too, is that in the case of interface <code>A</code> merging with later interface <code>A</code>, the second interface will have a higher precedence than the first.</p>
<p>That is, in the example:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Cloner</span> <span class="token punctuation">{</span>
    <span class="token function">clone</span><span class="token punctuation">(</span>animal<span class="token punctuation">:</span> Animal<span class="token punctuation">)</span><span class="token punctuation">:</span> Animal<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Cloner</span> <span class="token punctuation">{</span>
    <span class="token function">clone</span><span class="token punctuation">(</span>animal<span class="token punctuation">:</span> Sheep<span class="token punctuation">)</span><span class="token punctuation">:</span> Sheep<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">Cloner</span> <span class="token punctuation">{</span>
    <span class="token function">clone</span><span class="token punctuation">(</span>animal<span class="token punctuation">:</span> Dog<span class="token punctuation">)</span><span class="token punctuation">:</span> Dog<span class="token punctuation">;</span>
    <span class="token function">clone</span><span class="token punctuation">(</span>animal<span class="token punctuation">:</span> Cat<span class="token punctuation">)</span><span class="token punctuation">:</span> Cat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The three interfaces will merge to create a single declaration as so:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Cloner</span> <span class="token punctuation">{</span>
    <span class="token function">clone</span><span class="token punctuation">(</span>animal<span class="token punctuation">:</span> Dog<span class="token punctuation">)</span><span class="token punctuation">:</span> Dog<span class="token punctuation">;</span>
    <span class="token function">clone</span><span class="token punctuation">(</span>animal<span class="token punctuation">:</span> Cat<span class="token punctuation">)</span><span class="token punctuation">:</span> Cat<span class="token punctuation">;</span>
    <span class="token function">clone</span><span class="token punctuation">(</span>animal<span class="token punctuation">:</span> Sheep<span class="token punctuation">)</span><span class="token punctuation">:</span> Sheep<span class="token punctuation">;</span>
    <span class="token function">clone</span><span class="token punctuation">(</span>animal<span class="token punctuation">:</span> Animal<span class="token punctuation">)</span><span class="token punctuation">:</span> Animal<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Notice that the elements of each group maintains the same order, but the groups themselves are merged with later overload sets ordered first.</p>
<p>One exception to this rule is specialized signatures.<br>If a signature has a parameter whose type is a <em>single</em> string literal type (e.g. not a union of string literals), then it will be bubbled toward the top of its merged overload list.</p>
<p>For instance, the following interfaces will merge together:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HTMLDivElement<span class="token punctuation">;</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HTMLSpanElement<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HTMLElement<span class="token punctuation">;</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HTMLCanvasElement<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The resulting merged declaration of <code>Document</code> will be the following:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Document</span> <span class="token punctuation">{</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HTMLCanvasElement<span class="token punctuation">;</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HTMLDivElement<span class="token punctuation">;</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HTMLSpanElement<span class="token punctuation">;</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> HTMLElement<span class="token punctuation">;</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span>tagName<span class="token punctuation">:</span> <span class="token keyword">any</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Element<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="Merging-Namespaces"><a href="#Merging-Namespaces" class="headerlink" title="Merging Namespaces"></a>Merging Namespaces</h1><p>Similarly to interfaces, namespaces of the same name will also merge their members.<br>Since namespaces create both a namespace and a value, we need to understand how both merge.</p>
<p>To merge the namespaces, type definitions from exported interfaces declared in each namespace are themselves merged, forming a single namespace with merged interface definitions inside.</p>
<p>To merge the namespace value, at each declaration site, if a namespace already exists with the given name, it is further extended by taking the existing namespace and adding the exported members of the second namespace to the first.</p>
<p>The declaration merge of <code>Animals</code> in this example:</p>
<pre class=" language-ts"><code class="language-ts">namespace Animals <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Zebra</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

namespace Animals <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Legged</span> <span class="token punctuation">{</span> numberOfLegs<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>is equivalent to:</p>
<pre class=" language-ts"><code class="language-ts">namespace Animals <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Legged</span> <span class="token punctuation">{</span> numberOfLegs<span class="token punctuation">:</span> <span class="token keyword">number</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Zebra</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This model of namespace merging is a helpful starting place, but we also need to understand what happens with non-exported members.<br>Non-exported members are only visible in the original (un-merged) namespace. This means that after merging, merged members that came from other declarations cannot see non-exported members.</p>
<p>We can see this more clearly in this example:</p>
<pre class=" language-ts"><code class="language-ts">namespace Animal <span class="token punctuation">{</span>
    <span class="token keyword">let</span> haveMuscles <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">animalsHaveMuscles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> haveMuscles<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

namespace Animal <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">doAnimalsHaveMuscles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> haveMuscles<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// &lt;-- error, haveMuscles is not visible here</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Because <code>haveMuscles</code> is not exported, only the <code>animalsHaveMuscles</code> function that shares the same un-merged namespace can see the symbol.<br>The <code>doAnimalsHaveMuscles</code> function, even though it’s part of the merged <code>Animal</code> namespace can not see this un-exported member.</p>
<h1 id="Merging-Namespaces-with-Classes-Functions-and-Enums"><a href="#Merging-Namespaces-with-Classes-Functions-and-Enums" class="headerlink" title="Merging Namespaces with Classes, Functions, and Enums"></a>Merging Namespaces with Classes, Functions, and Enums</h1><p>Namespaces are flexible enough to also merge with other types of declarations.<br>To do so, the namespace declaration must follow the declaration it will merge with. The resulting declaration has properties of both declaration types.<br>TypeScript uses this capability to model some of the patterns in JavaScript as well as other programming languages.</p>
<h2 id="Merging-Namespaces-with-Classes"><a href="#Merging-Namespaces-with-Classes" class="headerlink" title="Merging Namespaces with Classes"></a>Merging Namespaces with Classes</h2><p>This gives the user a way of describing inner classes.</p>
<pre class=" language-ts"><code class="language-ts"><span class="token keyword">class</span> <span class="token class-name">Album</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> Album<span class="token punctuation">.</span>AlbumLabel<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
namespace Album <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AlbumLabel</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The visibility rules for merged members is the same as described in the ‘Merging Namespaces’ section, so we must export the <code>AlbumLabel</code> class for the merged class to see it.<br>The end result is a class managed inside of another class.<br>You can also use namespaces to add more static members to an existing class.</p>
<p>In addition to the pattern of inner classes, you may also be familiar with JavaScript practice of creating a function and then extending the function further by adding properties onto the function.<br>TypeScript uses declaration merging to build up definitions like this in a type-safe way.</p>
<pre class=" language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">buildLabel</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> buildLabel<span class="token punctuation">.</span>prefix <span class="token operator">+</span> name <span class="token operator">+</span> buildLabel<span class="token punctuation">.</span>suffix<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

namespace buildLabel <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">let</span> suffix <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">export</span> <span class="token keyword">let</span> prefix <span class="token operator">=</span> <span class="token string">"Hello, "</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">alert</span><span class="token punctuation">(</span><span class="token function">buildLabel</span><span class="token punctuation">(</span><span class="token string">"Sam Smith"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Similarly, namespaces can be used to extend enums with static members:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token keyword">enum</span> Color <span class="token punctuation">{</span>
    red <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    green <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
    blue <span class="token operator">=</span> <span class="token number">4</span>
<span class="token punctuation">}</span>

namespace Color <span class="token punctuation">{</span>
    <span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mixColor</span><span class="token punctuation">(</span>colorName<span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>colorName <span class="token operator">==</span> <span class="token string">"yellow"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Color<span class="token punctuation">.</span>red <span class="token operator">+</span> Color<span class="token punctuation">.</span>green<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>colorName <span class="token operator">==</span> <span class="token string">"white"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Color<span class="token punctuation">.</span>red <span class="token operator">+</span> Color<span class="token punctuation">.</span>green <span class="token operator">+</span> Color<span class="token punctuation">.</span>blue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>colorName <span class="token operator">==</span> <span class="token string">"magenta"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Color<span class="token punctuation">.</span>red <span class="token operator">+</span> Color<span class="token punctuation">.</span>blue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>colorName <span class="token operator">==</span> <span class="token string">"cyan"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Color<span class="token punctuation">.</span>green <span class="token operator">+</span> Color<span class="token punctuation">.</span>blue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="Disallowed-Merges"><a href="#Disallowed-Merges" class="headerlink" title="Disallowed Merges"></a>Disallowed Merges</h1><p>Not all merges are allowed in TypeScript.<br>Currently, classes can not merge with other classes or with variables.<br>For information on mimicking class merging, see the <a href="./Mixins.md">Mixins in TypeScript</a> section.</p>
<h1 id="Module-Augmentation"><a href="#Module-Augmentation" class="headerlink" title="Module Augmentation"></a>Module Augmentation</h1><p>Although JavaScript modules do not support merging, you can patch existing objects by importing and then updating them.<br>Let’s look at a toy Observable example:</p>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// observable.js</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ... implementation left as an exercise for the reader ...</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">// map.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./observable"</span><span class="token punctuation">;</span>
Observable<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ... another exercise for the reader</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This works fine in TypeScript too, but the compiler doesn’t know about <code>Observable.prototype.map</code>.<br>You can use module augmentation to tell the compiler about it:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// observable.ts stays the same</span>
<span class="token comment" spellcheck="true">// map.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./observable"</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">"./observable"</span> <span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
        map<span class="token operator">&lt;</span>U<span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> U<span class="token punctuation">)</span><span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>U<span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Observable<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ... another exercise for the reader</span>
<span class="token punctuation">}</span>


<span class="token comment" spellcheck="true">// consumer.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./observable"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"./map"</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> o<span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span><span class="token keyword">number</span><span class="token operator">></span><span class="token punctuation">;</span>
o<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">></span> x<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The module name is resolved the same way as module specifiers in <code>import</code>/<code>export</code>.<br>See <a href="./Modules.md">Modules</a> for more information.<br>Then the declarations in an augmentation are merged as if they were declared in the same file as the original.<br>However, you can’t declare new top-level declarations in the augmentation – just patches to existing declarations.</p>
<h2 id="Global-augmentation"><a href="#Global-augmentation" class="headerlink" title="Global augmentation"></a>Global augmentation</h2><p>You can also add declarations to the global scope from inside a module:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// observable.ts</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ... still no implementation ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">declare</span> global <span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name">Array</span><span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token function">toObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Observable<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toObservable <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Global augmentations have the same behavior and limits as module augmentations.</p>

  </div>
</div>


<p class="nav-foot">
  <span class="left"><a href="/2018/05/25/online-ts-17/">« Module Res...</a></span>
  <span class="right"><a href="/2018/05/25/online-ts-19/">JSX... »</a></span>
</p>

<!-- 文档信息 -->
<div class="post-foot">
  <h3>文档信息</h3>
  <ul>
    <li>版权声明：自由转载-非商用-非衍生-保持署名（
      <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>）
    </li>
    <li>作者：<a href="/">Lian</a></li>
    <li>日期：2018年05月25日 18:05</li>
    <li>邮箱：lian1925@126.com</li>
  </ul>
</div>
      




<div class="content-comment">
  <h2>留言</h2>
  
  
		
</div>

<!-- 评论输入组件，填写数据：留言，称呼，电子邮件 -->

<div class="form-comment">
  <h2>
		我要发表看法
	</h2>

	<form method="post" 
	target="targetIfr"
	action="">
	 <!-- 留言正文 -->
	 
		
<p>
	<label for="comment-content">
		您的留言:
	</label>
</p>

<p>
	<textarea 
	id="comment-content" 
	name="content" 
	rows="10" cols="50">
	</textarea>
</p>

		<!-- 姓名 -->
	 
		
<p>
	<label for="comment-author">
		您的大名:
	</label>
</p>

<p>
	<input 
	id="comment-author" 
	name="author" 
	size="30" 
	value=""
	pattern="^.{2,150}$"
	required
	>
	<span class="hint">
			 «-必填
	</span
</p>


		<!-- 微信 -->
	 
		
<p>
	<label for="comment-wechat">
		您的微信:
	</label>
</p>

<p>
	<input 
	id="comment-wechat" 
	name="wechat" 
	size="30" 
	value=""
	pattern="^[a-zA-Zd_]{5,}$"
	
	>
	<span class="hint">
			 «-选填，不公开
	</span
</p>


		<!-- 电子邮箱 -->
		
		
<p>
	<label for="comment-email">
		电子邮箱：
	</label>
</p>

<p>
	<input 
	id="comment-email" 
	name="email" 
	size="30" 
	value=""
	pattern="^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(.[a-zA-Z0-9_-]+)+$"
	
	>
	<span class="hint">
			 «-选填，不公开
	</span
</p>


		
		<p>

		
<div class="button">
    <input 
    class="submit-button" 
    onclick="doButton('addComment')"
    value="发表">
    <span class="hint"> «- 点击按钮</span>
</div>
		</p>
	</form>
	<iframe name="targetIfr" style="display:none"></iframe> 
</div>


<!-- data:{
	name:'',
	type:'passwor',
	label:'您的大名',
	hint:'',
	pattern:'[A-z]{3}',
	required:"required"
} -->


<p id="info-meta" style="display:none;">
  online-ts-18
</p>


<p id="info-url" style="display:none;">
  
</p>

<div class="footer">
  Copyright @ <a href="/">lian</a> | 2009-2018
</div>

</div>

<script src="/js/jquery.js"></script>
<script src="/js/APlayer.min.js"></script>
<script src="/js/post.js"></script>

</body>

</html>

