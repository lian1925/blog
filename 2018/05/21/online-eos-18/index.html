
<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" type="image/png" href="/img/sand2.png">
  <link rel="shortcut icon" type="image/x-icon" href="/img/sand2.png">
  <meta property="og:image" content="https://assets-cdn.github.com/images/modules/open_graph/github-octocat.png">
  
  <link rel="stylesheet" href="/css/style.css?v=1.3"> 
  <link href="//vjs.zencdn.net/6.7/video-js.min.css" rel="stylesheet">
  <script src="//vjs.zencdn.net/6.7/video.min.js"></script>
  
  <title>Tic Tac Toe【游戏】 | 小沙丘的网络漫游记</title>
 <meta name="description" content="" >

 <!-- 百度统计 -->
 <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?eafa0040e1ab3bed28ce82ef03de6e01";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
  
<link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css"></head>
<body>
  
  <script>
      if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)){
        document.body.classList.add('mobile');            
      } else{
        document.body.classList.add('pc');
        document.getElementsByTagName("html")[0].style.fontSize="62.5%";
      }
      var u = navigator.userAgent;
var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
if(isiOS){
  document.body.classList.add('ios');
  document.getElementsByTagName("html")[0].style.fontSize="65%";
           
}
    </script>

  <div class="container">
<!-- 用于文章页面的顶部，提供返回主页和主题页的按键 -->
<!-- 头部开始 -->

<div id="header">
    <p>小沙丘的网络漫游记
      <span> » 
        <a href="/home/">首页</a>
      </span>
      
      <span> » 
          <a href="/tags/EOS/">
            EOS
          </a>
      </span>
      
    </p>
</div>

<!-- 头部结束 -->



<!-- 分类组件，放置于文章页面的顶部，提供上(或下)一篇导航按键。 -->
<div class="asset-nav">
    <div class="entry-categories">
      <p>主题：
        <span> 
            <a href="/tags/EOS/">
              EOS
            </a>
        </span>
      </p>
    </div>
    <div class="entry-location-mobile">
        <span>
            
            <a href="/2018/05/21/online-eos-17/">
            &#8676;
            </a>
        </span>
        <span>
            
            <a href="/2018/05/21/online-eos-19/">
              &#8677;
            </a>
        </span>
    </div>
    <div class="entry-location">
        <P>上一篇：
                <a href="/2018/05/21/online-eos-17/">
                    Bios Boot【启动】 Sequence【序列】
                </a>
        </P>
        <P>下一篇：

                <a href="/2018/05/21/online-eos-19/">
                    Single【单一】 Host【主机】 Multinode【多节点】
                </a>
        </P>
    </div>
</div>

<div class="post">
<div class="title-post">
<h1>Tic Tac Toe【游戏】</h1>
<div class="post-meta">
  <p>作者： Lian</p>
  <p>日期：
    2018年05月21日 20:05
  </p>
</div>
</div>



  
  <div class="page">
      <h2 id="Objective【目标】"><a href="#Objective【目标】" class="headerlink" title="Objective【目标】"></a>Objective【目标】</h2><p>The following tutorial【教程】 will guide【引导】 the user to build【建立】 a sample Player【播放器】 vs Player game contract【合约】. We will use tic tac toe game to demonstrate【实现】 this. Final result of this tutorial can be found here.</p>
<h2 id="Assumption【假设】"><a href="#Assumption【假设】" class="headerlink" title="Assumption【假设】"></a>Assumption【假设】</h2><p>For this game, we are using a standard【标准】 3x3 tic tac toe board. Players are divided【分成】 into two roles【两组】: host【主场】 and challenger【挑战者】. Host always makes the first【首先】 move. Each pair of players can ONLY have up to【最多】 two games at the same time, one where the first player becomes the host and the other one where the second player becomes the host.</p>
<h3 id="Board【场地】"><a href="#Board【场地】" class="headerlink" title="Board【场地】"></a>Board【场地】</h3><p>Instead of using o and x as in the traditional【传统】 tic tac toe game. We use 1 to denote movement【动作】 by host, 2 to denote movement by challenger, and 0 to denote empty【空】 cell. Furthermore, we will use one dimensional array【数组】 to store the board. Hence【因此】:</p>
<p>(0,0)    (1,0)    (2,0)<br>(0,0)    -    o    x<br>(0,1)    -    x    -<br>(0,2)    x    o    o<br>Assuming【想象】 x is host, the above board is equal【等效】 to [0, 2, 1, 0, 1, 0, 1, 2, 2]</p>
<h3 id="Action【行为】"><a href="#Action【行为】" class="headerlink" title="Action【行为】"></a>Action【行为】</h3><p>User will have the following【如下】 actions to interact with【交互】 this contract【合约】:</p>
<p>create【创建】: create a new game<br>restart【重启】: restart an existing game, host or challenger is allowed to do this<br>close【关闭】: close an existing game, which frees up the storage used to store the game, only host is allowed to do this<br>move【移动】: make a movement</p>
<h3 id="Contract【合约】-account【账户】"><a href="#Contract【合约】-account【账户】" class="headerlink" title="Contract【合约】 account【账户】"></a>Contract【合约】 account【账户】</h3><p>For the following guide【指导】, we are going to push the contract to an account called tic.tac.toe. In case tic.tac.toe account name is already【已经】 taken, you can also use another account by replacing【替换】 any occurence【冲突】 of tic.tac.toe in the code with your account name. If you haven’t created the account, please create the account first【首先】.</p>
<pre class=" language-js"><code class="language-js">$ cleos create account $<span class="token punctuation">{</span>creator_name<span class="token punctuation">}</span> $<span class="token punctuation">{</span>contract_account_name<span class="token punctuation">}</span> $<span class="token punctuation">{</span>contract_pub_owner_key<span class="token punctuation">}</span> $<span class="token punctuation">{</span>contract_pub_active_key<span class="token punctuation">}</span> <span class="token operator">--</span>permission $<span class="token punctuation">{</span>creator_name<span class="token punctuation">}</span>@active
# e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> $ cleos create account inita tic<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>toe  EOS4toFS3YXEQCkuuw1aqDLrtHim86Gz9u3hBdcBw5KNPZcursVHq EOS7d9A3uLe6As66jzN8j44TXJUqJSK3bFjjEEqR4oTvNAB3iM9SA <span class="token operator">--</span>permission inita@active
</code></pre>
<p>Ensure that you have your wallet【钱包】 unlocked and the creator’s private【私有】 active key in the wallet imported【导入】, otherwise the above command will fail【失败】.</p>
<h2 id="Start【开始】"><a href="#Start【开始】" class="headerlink" title="Start【开始】!"></a>Start【开始】!</h2><p>We are going to create three files【3个文件】 here:</p>
<ul>
<li><p>tic_tac_toe.hpp =&gt; header file where the structure of the contract is defined</p>
</li>
<li><p>tic_tac_toe.cpp =&gt; main logic【逻辑】 of the contract【合约】</p>
</li>
<li><p>tic_tac_toe.abi =&gt; interface【接口】 for user to interact with the contract NB: In this example we use the account name of N(tic.tac.toe) for the contract account. If you plan【计划】 to use a differnt【不同】 name for the contract account, then replace【替换】 tic.tac.toe with your account name.</p>
</li>
</ul>
<h2 id="Defining【定义】-Structure【结构】"><a href="#Defining【定义】-Structure【结构】" class="headerlink" title="Defining【定义】 Structure【结构】"></a>Defining【定义】 Structure【结构】</h2><p>Let’s first start with the header file【头文件】 and define the structure【结构】 of the contract【合约】. Open tic_tac_toe.hpp and start with the following boilerplate【模板】</p>
<pre class=" language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">// Import necessary library</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;eosiolib/eosio.hpp></span> </span><span class="token comment" spellcheck="true">// Generic eosio library, i.e. print, type, math, etc</span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> eosio<span class="token punctuation">;</span>
<span class="token keyword">namespace</span> tic_tac_toe <span class="token punctuation">{</span>
   <span class="token keyword">static</span> <span class="token keyword">const</span> account_name games_account <span class="token operator">=</span> <span class="token function">N</span><span class="token punctuation">(</span>games<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">static</span> <span class="token keyword">const</span> account_name code_account <span class="token operator">=</span> <span class="token function">N</span><span class="token punctuation">(</span>tic<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>toe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Your code here</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="Games-Table【表格】"><a href="#Games-Table【表格】" class="headerlink" title="Games Table【表格】"></a>Games Table【表格】</h3><p>For this contract, we will need to have a table that stores【存储】 a list of games. Let’s define【定义】 it:</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">...</span>
namespace tic_tac_toe <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    typedef eosio<span class="token punctuation">:</span><span class="token punctuation">:</span>multi_index<span class="token operator">&lt;</span> games_account<span class="token punctuation">,</span> game<span class="token operator">></span> games<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>First template parameter【参数】 defines the name of the table</p>
<p>Second template parameter defines the structure【结构】 that it stores【结构】 (will be defined in the next section)</p>
<h2 id="Game【游戏】-Structure【结构】"><a href="#Game【游戏】-Structure【结构】" class="headerlink" title="Game【游戏】 Structure【结构】"></a>Game【游戏】 Structure【结构】</h2><p>Let’s define structure for the game. Ensure【保证】 that this struct definition appears【出现】 before the table definition in the code.</p>
<pre class=" language-cpp"><code class="language-cpp"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">namespace</span> tic_tac_toe <span class="token punctuation">{</span>
   <span class="token keyword">static</span> <span class="token keyword">const</span> uint32_t board_len <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
   <span class="token keyword">struct</span> game <span class="token punctuation">{</span>
      <span class="token function">game</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token function">game</span><span class="token punctuation">(</span>account_name challenger<span class="token punctuation">,</span> account_name host<span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">challenger</span><span class="token punctuation">(</span>challenger<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">host</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">turn</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment" spellcheck="true">// Initialize board</span>
         <span class="token function">initialize_board</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      account_name     challenger<span class="token punctuation">;</span>
      account_name     host<span class="token punctuation">;</span>
      account_name     turn<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// = account name of host/ challenger</span>
      account_name     winner <span class="token operator">=</span> <span class="token function">N</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// = none/ draw/ account name of host/ challenger</span>
      uint8_t          board<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//</span>

      <span class="token comment" spellcheck="true">// Initialize board with empty cell</span>
      <span class="token keyword">void</span> <span class="token function">initialize_board</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span>uint8_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> board_len <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            board<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment" spellcheck="true">// Reset game</span>
      <span class="token keyword">void</span> <span class="token function">reset_game</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token function">initialize_board</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         turn <span class="token operator">=</span> host<span class="token punctuation">;</span>
         winner <span class="token operator">=</span> <span class="token function">N</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">auto</span> <span class="token function">primary_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> challenger<span class="token punctuation">;</span> <span class="token punctuation">}</span>

      <span class="token function">EOSLIB_SERIALIZE</span><span class="token punctuation">(</span> game<span class="token punctuation">,</span> <span class="token punctuation">(</span>challenger<span class="token punctuation">)</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">(</span>turn<span class="token punctuation">)</span><span class="token punctuation">(</span>winner<span class="token punctuation">)</span><span class="token punctuation">(</span>board<span class="token punctuation">)</span> <span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The primary_key【主键】 method is required by the above table definition【定义】 for games. That is how the table knows what field is the lookup key for the table.</p>
<h2 id="Action【行为】-Structure【结构】"><a href="#Action【行为】-Structure【结构】" class="headerlink" title="Action【行为】 Structure【结构】"></a>Action【行为】 Structure【结构】</h2><h3 id="Create【创建】"><a href="#Create【创建】" class="headerlink" title="Create【创建】"></a>Create【创建】</h3><p>To create the game, we need host【主机】 account name and challenger’s account name. The EOSLIB_SERIALIZE macro provides serialize【序列化】 and deserialize【非序列化】 methods so that actions can be passed【传递】 back and forth between the contracts and the nodeos system.</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">...</span>
namespace tic_tac_toe <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   struct create <span class="token punctuation">{</span>
      account_name   challenger<span class="token punctuation">;</span>
      account_name   host<span class="token punctuation">;</span>

      <span class="token function">EOSLIB_SERIALIZE</span><span class="token punctuation">(</span> create<span class="token punctuation">,</span> <span class="token punctuation">(</span>challenger<span class="token punctuation">)</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="Restart【重启】"><a href="#Restart【重启】" class="headerlink" title="Restart【重启】"></a>Restart【重启】</h2><p>To restart the game, we need host account name and challenger’s account name to identify【识别】 the game. Furthermore【另外】, we need to specify【指定】 who wants to restart the game, so we can verify【校验】 the correct signature is provided.</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">...</span>
namespace tic_tac_toe <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   struct restart <span class="token punctuation">{</span>
      account_name   challenger<span class="token punctuation">;</span>
      account_name   host<span class="token punctuation">;</span>
      account_name   by<span class="token punctuation">;</span>

      <span class="token function">EOSLIB_SERIALIZE</span><span class="token punctuation">(</span> restart<span class="token punctuation">,</span> <span class="token punctuation">(</span>challenger<span class="token punctuation">)</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">(</span>by<span class="token punctuation">)</span> <span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="Close【关闭】"><a href="#Close【关闭】" class="headerlink" title="Close【关闭】"></a>Close【关闭】</h2><p>To close the game, we need host account name and challenger’s account name to identify the game.</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">...</span>
namespace tic_tac_toe <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   struct close <span class="token punctuation">{</span>
      account_name   challenger<span class="token punctuation">;</span>
      account_name   host<span class="token punctuation">;</span>

      <span class="token function">EOSLIB_SERIALIZE</span><span class="token punctuation">(</span> close<span class="token punctuation">,</span> <span class="token punctuation">(</span>challenger<span class="token punctuation">)</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="Move【删除】"><a href="#Move【删除】" class="headerlink" title="Move【删除】"></a>Move【删除】</h2><p>To make a move, we need host account name and challenger’s account name to identify the game. Furthermore, we need to specify【指定】 who makes this move and the movement【动作】 he is making.</p>
<pre class=" language-js"><code class="language-js"><span class="token operator">...</span>
namespace tic_tac_toe <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   struct movement <span class="token punctuation">{</span>
      uint32_t    row<span class="token punctuation">;</span>
      uint32_t    column<span class="token punctuation">;</span>

      <span class="token function">EOSLIB_SERIALIZE</span><span class="token punctuation">(</span> movement<span class="token punctuation">,</span> <span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">(</span>column<span class="token punctuation">)</span> <span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   struct move <span class="token punctuation">{</span>
      account_name   challenger<span class="token punctuation">;</span>
      account_name   host<span class="token punctuation">;</span>
      account_name   by<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// the account who wants to make the move</span>
      movement       mvt<span class="token punctuation">;</span>

      <span class="token function">EOSLIB_SERIALIZE</span><span class="token punctuation">(</span> move<span class="token punctuation">,</span> <span class="token punctuation">(</span>challenger<span class="token punctuation">)</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">(</span>by<span class="token punctuation">)</span><span class="token punctuation">(</span>mvt<span class="token punctuation">)</span> <span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can see the final【最终】 tic_tac_toe.hpp here</p>
<h2 id="Main【主要】"><a href="#Main【主要】" class="headerlink" title="Main【主要】"></a>Main【主要】</h2><p>Let’s open tic_tac_toe.cpp and setup the boilerplate【模板】</p>
<pre class=" language-ts"><code class="language-ts">#include <span class="token string">"tic_tac_toe.hpp"</span>
using namespace eosio<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">/**
*  The apply() method must have C calling convention so that the blockchain can lookup and
*  call these methods.
*/</span>
extern <span class="token string">"C"</span> <span class="token punctuation">{</span>

   using namespace tic_tac_toe<span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true">/// The apply method implements the dispatch of events to this contract</span>
   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span> uint64_t receiver<span class="token punctuation">,</span> uint64_t code<span class="token punctuation">,</span> uint64_t action <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Put your action handler here</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// extern "C"</span>
</code></pre>
<h3 id="Action-handler【管理者】"><a href="#Action-handler【管理者】" class="headerlink" title="Action handler【管理者】"></a>Action handler【管理者】</h3><p>We want tic_tac_toe contract【合约】 to only react to actions sent【发送】 to the tic.tac.toe account and react differently【不同】 according to the type【类型】 of the action. Let’s add an impl struct with overloaded ‘on’ methods taking the different action types【类型】 (this may seem like overkill for this example, but you will see this pattern employed in other contracts that you can extend, like currency):</p>
<pre class=" language-ts"><code class="language-ts">using namespace eosio<span class="token punctuation">;</span>
namespace tic_tac_toe <span class="token punctuation">{</span>
struct impl <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   <span class="token comment" spellcheck="true">/// The apply method implements the dispatch of events to this contract</span>
   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span> uint64_t receiver<span class="token punctuation">,</span> uint64_t code<span class="token punctuation">,</span> uint64_t action <span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">==</span> code_account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">==</span> <span class="token function">N</span><span class="token punctuation">(</span>create<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            impl<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span>eosio<span class="token punctuation">:</span><span class="token punctuation">:</span>unpack_action_data<span class="token operator">&lt;</span>tic_tac_toe<span class="token punctuation">:</span><span class="token punctuation">:</span>create<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">==</span> <span class="token function">N</span><span class="token punctuation">(</span>restart<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            impl<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span>eosio<span class="token punctuation">:</span><span class="token punctuation">:</span>unpack_action_data<span class="token operator">&lt;</span>tic_tac_toe<span class="token punctuation">:</span><span class="token punctuation">:</span>restart<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">==</span> <span class="token function">N</span><span class="token punctuation">(</span>close<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            impl<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span>eosio<span class="token punctuation">:</span><span class="token punctuation">:</span>unpack_action_data<span class="token operator">&lt;</span>tic_tac_toe<span class="token punctuation">:</span><span class="token punctuation">:</span>close<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">==</span> <span class="token function">N</span><span class="token punctuation">(</span>move<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            impl<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">on</span><span class="token punctuation">(</span>eosio<span class="token punctuation">:</span><span class="token punctuation">:</span>unpack_action_data<span class="token operator">&lt;</span>tic_tac_toe<span class="token punctuation">:</span><span class="token punctuation">:</span>move<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>
extern <span class="token string">"C"</span> <span class="token punctuation">{</span>

   using namespace tic_tac_toe<span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true">/// The apply method implements the dispatch of events to this contract</span>
   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span> uint64_t receiver<span class="token punctuation">,</span> uint64_t code<span class="token punctuation">,</span> uint64_t action <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">impl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>receiver<span class="token punctuation">,</span> code<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// extern "C"</span>
</code></pre>
<p>Notice【注意】 that we use unpack_action_data<t>() before passing it to specific handler, unpack_action_data<t>() is converting the action that the contract receives to struct T.</t></t></p>
<p>To make things tidy【简洁】, we will encapsulate【封装】 the action handlers inside struct impl:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token operator">...</span>
struct impl <span class="token punctuation">{</span>
<span class="token operator">...</span>
   <span class="token comment" spellcheck="true">/**
    * @param create - action to be applied
    */</span>
   <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token keyword">const</span> create<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Put code for create action here</span>
   <span class="token punctuation">}</span>

   <span class="token comment" spellcheck="true">/**
    * @brief Apply restart action
    * @param restart - action to be applied
    */</span>
   <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token keyword">const</span> restart<span class="token operator">&amp;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Put code for restart action here</span>
   <span class="token punctuation">}</span>

   <span class="token comment" spellcheck="true">/**
    * @brief Apply close action
    * @param close - action to be applied
    */</span>
   <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token keyword">const</span> close<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Put code for close action here</span>
   <span class="token punctuation">}</span>

   <span class="token comment" spellcheck="true">/**
    * @brief Apply move action
    * @param move - action to be applied
    */</span>
   <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token keyword">const</span> move<span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Put code for move action here</span>
   <span class="token punctuation">}</span>

   <span class="token comment" spellcheck="true">/// The apply method implements the dispatch of events to this contract</span>
   <span class="token keyword">void</span> <span class="token function">apply</span><span class="token punctuation">(</span> uint64_t receiver<span class="token punctuation">,</span> uint64_t code<span class="token punctuation">,</span> uint64_t action <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">...</span>
</code></pre>
<h3 id="Create【创建】-Action-Handler【管理器】"><a href="#Create【创建】-Action-Handler【管理器】" class="headerlink" title="Create【创建】 Action Handler【管理器】"></a>Create【创建】 Action Handler【管理器】</h3><p>For the create action handler, we want to:</p>
<p>Ensure【保证】 that the action has signature【签名】 from the host</p>
<p>Ensure that the challenger and host are not the same【相同】 player【玩家】</p>
<p>Ensure that there is no existing【已存在】 game</p>
<p>Store【存储】 the newly created game into the db</p>
<pre class=" language-ts"><code class="language-ts">struct impl <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   <span class="token comment" spellcheck="true">/**
    * @brief Apply create action
    * @param create - action to be applied
    */</span>
   <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token keyword">const</span> create<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">require_auth</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>challenger <span class="token operator">!=</span> c<span class="token punctuation">.</span>host<span class="token punctuation">,</span> <span class="token string">"challenger shouldn't be the same as host"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Check if game already exists</span>
      games <span class="token function">existing_host_games</span><span class="token punctuation">(</span>code_account<span class="token punctuation">,</span> c<span class="token punctuation">.</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
      auto itr <span class="token operator">=</span> existing_host_games<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> c<span class="token punctuation">.</span>challenger <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span>itr <span class="token operator">==</span> existing_host_games<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"game already exists"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      existing_host_games<span class="token punctuation">.</span><span class="token function">emplace</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>host<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span> auto<span class="token operator">&amp;</span> g <span class="token punctuation">)</span> <span class="token punctuation">{</span>
         g<span class="token punctuation">.</span>challenger <span class="token operator">=</span> c<span class="token punctuation">.</span>challenger<span class="token punctuation">;</span>
         g<span class="token punctuation">.</span>host <span class="token operator">=</span> c<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
         g<span class="token punctuation">.</span>turn <span class="token operator">=</span> c<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="Restart【重启】-Action-Handler"><a href="#Restart【重启】-Action-Handler" class="headerlink" title="Restart【重启】 Action Handler"></a>Restart【重启】 Action Handler</h3><p>For the restart action handler, we want to:</p>
<p>Ensure that the action【行为】 has signature from the host/ challenger</p>
<p>Ensure that the game exists【存在】</p>
<p>Ensure that the restart action is done【执行】 by host/ challenger</p>
<p>Reset【重设】 the game<br>Store【存储】 the updated game to the db</p>
<pre class=" language-ts"><code class="language-ts">struct impl <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   <span class="token comment" spellcheck="true">/**
    * @brief Apply restart action
    * @param restart - action to be applied
    */</span>
   <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token keyword">const</span> restart<span class="token operator">&amp;</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">require_auth</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>by<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Check if game exists</span>
      games <span class="token function">existing_host_games</span><span class="token punctuation">(</span>code_account<span class="token punctuation">,</span> r<span class="token punctuation">.</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
      auto itr <span class="token operator">=</span> existing_host_games<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> r<span class="token punctuation">.</span>challenger <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span>itr <span class="token operator">!=</span> existing_host_games<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"game doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Check if this game belongs to the action sender</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>by <span class="token operator">==</span> itr<span class="token operator">-</span><span class="token operator">></span>host <span class="token operator">||</span> r<span class="token punctuation">.</span>by <span class="token operator">==</span> itr<span class="token operator">-</span><span class="token operator">></span>challenger<span class="token punctuation">,</span> <span class="token string">"this is not your game!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Reset game</span>
      existing_host_games<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span>itr<span class="token punctuation">,</span> itr<span class="token operator">-</span><span class="token operator">></span>host<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span> auto<span class="token operator">&amp;</span> g <span class="token punctuation">)</span> <span class="token punctuation">{</span>
         g<span class="token punctuation">.</span><span class="token function">reset_game</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="Close【关闭】-Action-Handler"><a href="#Close【关闭】-Action-Handler" class="headerlink" title="Close【关闭】 Action Handler"></a>Close【关闭】 Action Handler</h3><p>For the close action handler, we want to:</p>
<p>Ensure that the action has signature【签名】 from the host</p>
<p>Ensure that the game exists【存在】</p>
<p>Remove【删除】 the game from the db</p>
<pre class=" language-ts"><code class="language-ts">struct impl <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   <span class="token comment" spellcheck="true">/**
    * @brief Apply close action
    * @param close - action to be applied
    */</span>
   <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token keyword">const</span> close<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">require_auth</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Check if game exists</span>
      games <span class="token function">existing_host_games</span><span class="token punctuation">(</span>code_account<span class="token punctuation">,</span> c<span class="token punctuation">.</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
      auto itr <span class="token operator">=</span> existing_host_games<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> c<span class="token punctuation">.</span>challenger <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span>itr <span class="token operator">!=</span> existing_host_games<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"game doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Remove game</span>
      existing_host_games<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>itr<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="Move【删除】-Action-Handler"><a href="#Move【删除】-Action-Handler" class="headerlink" title="Move【删除】 Action Handler"></a>Move【删除】 Action Handler</h3><p>For the move action handler, we want to:</p>
<p>Ensure that the action has signature【签名】 from the host/ challenger</p>
<p>Ensure that the game exists</p>
<p>Ensure that the game is not finished yet【还没】</p>
<p>Ensure that the move action is done by host/ challenger</p>
<p>Ensure that this is the right【权限】 user’s turn</p>
<p>Verify movement is valid【有效】</p>
<p>Update board with the new move【移动】</p>
<p>Change the move_turn to the other player</p>
<p>Determine【决定】 if there is a winner</p>
<p>Store【存储】 the updated game to the db</p>
<pre class=" language-ts"><code class="language-ts">struct impl <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   bool <span class="token function">is_valid_movement</span><span class="token punctuation">(</span><span class="token keyword">const</span> movement<span class="token operator">&amp;</span> mvt<span class="token punctuation">,</span> <span class="token keyword">const</span> game<span class="token operator">&amp;</span> game_for_movement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Put code here</span>
   <span class="token punctuation">}</span>

   account_name <span class="token function">get_winner</span><span class="token punctuation">(</span><span class="token keyword">const</span> game<span class="token operator">&amp;</span> current_game<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// Put code here</span>
   <span class="token punctuation">}</span>
   <span class="token operator">...</span>
   <span class="token comment" spellcheck="true">/**
    * @brief Apply move action
    * @param move - action to be applied
    */</span>
   <span class="token keyword">void</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token keyword">const</span> move<span class="token operator">&amp;</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">require_auth</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>by<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Check if game exists</span>
      games <span class="token function">existing_host_games</span><span class="token punctuation">(</span>code_account<span class="token punctuation">,</span> m<span class="token punctuation">.</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
      auto itr <span class="token operator">=</span> existing_host_games<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> m<span class="token punctuation">.</span>challenger <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span>itr <span class="token operator">!=</span> existing_host_games<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"game doesn't exists"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Check if this game hasn't ended yet</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span>itr<span class="token operator">-</span><span class="token operator">></span>winner <span class="token operator">==</span> <span class="token function">N</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"the game has ended!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// Check if this game belongs to the action sender</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>by <span class="token operator">==</span> itr<span class="token operator">-</span><span class="token operator">></span>host <span class="token operator">||</span> m<span class="token punctuation">.</span>by <span class="token operator">==</span> itr<span class="token operator">-</span><span class="token operator">></span>challenger<span class="token punctuation">,</span> <span class="token string">"this is not your game!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment" spellcheck="true">// Check if this is the  action sender's turn</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>by <span class="token operator">==</span> itr<span class="token operator">-</span><span class="token operator">></span>turn<span class="token punctuation">,</span> <span class="token string">"it's not your turn yet!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


      <span class="token comment" spellcheck="true">// Check if user makes a valid movement</span>
      <span class="token function">eosio_assert</span><span class="token punctuation">(</span><span class="token function">is_valid_movement</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>mvt<span class="token punctuation">,</span> <span class="token operator">*</span>itr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"not a valid movement!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// Fill the cell, 1 for host, 2 for challenger</span>
      <span class="token keyword">const</span> auto cell_value <span class="token operator">=</span> itr<span class="token operator">-</span><span class="token operator">></span>turn <span class="token operator">==</span> itr<span class="token operator">-</span><span class="token operator">></span>host <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> auto turn <span class="token operator">=</span> itr<span class="token operator">-</span><span class="token operator">></span>turn <span class="token operator">==</span> itr<span class="token operator">-</span><span class="token operator">></span>host <span class="token operator">?</span> itr<span class="token operator">-</span><span class="token operator">></span>challenger <span class="token punctuation">:</span> itr<span class="token operator">-</span><span class="token operator">></span>host<span class="token punctuation">;</span>
      existing_host_games<span class="token punctuation">.</span><span class="token function">modify</span><span class="token punctuation">(</span>itr<span class="token punctuation">,</span> itr<span class="token operator">-</span><span class="token operator">></span>host<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token punctuation">]</span><span class="token punctuation">(</span> auto<span class="token operator">&amp;</span> g <span class="token punctuation">)</span> <span class="token punctuation">{</span>
         g<span class="token punctuation">.</span>board<span class="token punctuation">[</span>m<span class="token punctuation">.</span>mvt<span class="token punctuation">.</span>row <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> m<span class="token punctuation">.</span>mvt<span class="token punctuation">.</span>column<span class="token punctuation">]</span> <span class="token operator">=</span> cell_value<span class="token punctuation">;</span>
         g<span class="token punctuation">.</span>turn <span class="token operator">=</span> turn<span class="token punctuation">;</span>

         <span class="token comment" spellcheck="true">//check to see if we have a winner</span>
         g<span class="token punctuation">.</span>winner <span class="token operator">=</span> <span class="token function">get_winner</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="Movement【动作】-Validation【校验】"><a href="#Movement【动作】-Validation【校验】" class="headerlink" title="Movement【动作】 Validation【校验】"></a>Movement【动作】 Validation【校验】</h3><p>Valid movement is defined【定义】 as movement done inside the board on an empty【空】 cell:</p>
<pre class=" language-ts"><code class="language-ts">struct impl <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   <span class="token comment" spellcheck="true">/**
    * @brief Check if cell is empty
    * @param cell - value of the cell (should be either 0, 1, or 2)
    * @return true if cell is empty
    */</span>
   bool <span class="token function">is_empty_cell</span><span class="token punctuation">(</span><span class="token keyword">const</span> uint8_t<span class="token operator">&amp;</span> cell<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> cell <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment" spellcheck="true">/**
    * @brief Check for valid movement
    * @detail Movement is considered valid if it is inside the board and done on empty cell
    * @param movement - the movement made by the player
    * @param game - the game on which the movement is being made
    * @return true if movement is valid
    */</span>
   bool <span class="token function">is_valid_movement</span><span class="token punctuation">(</span><span class="token keyword">const</span> movement<span class="token operator">&amp;</span> mvt<span class="token punctuation">,</span> <span class="token keyword">const</span> game<span class="token operator">&amp;</span> game_for_movement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      uint32_t movement_location <span class="token operator">=</span> mvt<span class="token punctuation">.</span>row <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> mvt<span class="token punctuation">.</span>column<span class="token punctuation">;</span>
      bool is_valid <span class="token operator">=</span> movement_location <span class="token operator">&lt;</span> board_len <span class="token operator">&amp;&amp;</span> <span class="token function">is_empty_cell</span><span class="token punctuation">(</span>game_for_movement<span class="token punctuation">.</span>board<span class="token punctuation">[</span>movement_location<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> is_valid<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="Get-Winner【胜利者】"><a href="#Get-Winner【胜利者】" class="headerlink" title="Get Winner【胜利者】"></a>Get Winner【胜利者】</h3><p>Winner is defined【定义】 as the first player who succeeds【成功】 in placing three【三个】 of their marks in a horizontal, vertical, or diagonal row.</p>
<pre class=" language-ts"><code class="language-ts">struct impl <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   <span class="token comment" spellcheck="true">/**
    * @brief Get winner of the game
    * @detail Winner of the game is the first player who made three consecutive aligned movement
    * @param game - the game which we want to determine the winner of
    * @return winner of the game (can be either none/ draw/ account name of host/ account name of challenger)
    */</span>
   account_name <span class="token function">get_winner</span><span class="token punctuation">(</span><span class="token keyword">const</span> game<span class="token operator">&amp;</span> current_game<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span>
         <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span>
         <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span>
         <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment" spellcheck="true">//  - | - | x    x | - | -    - | - | -    - | x | -</span>
         <span class="token comment" spellcheck="true">//  - | x | -    - | x | -    x | x | x    - | x | -</span>
         <span class="token comment" spellcheck="true">//  x | - | -    - | - | x    - | - | -    - | x | -</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> current_game<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> current_game<span class="token punctuation">.</span>challenger<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                 <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment" spellcheck="true">//  x | x | x       x | - | -</span>
         <span class="token comment" spellcheck="true">//  - | - | -       x | - | -</span>
         <span class="token comment" spellcheck="true">//  - | - | -       x | - | -</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> current_game<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> current_game<span class="token punctuation">.</span>challenger<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                 <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment" spellcheck="true">//  - | - | -       - | - | x</span>
         <span class="token comment" spellcheck="true">//  - | - | -       - | - | x</span>
         <span class="token comment" spellcheck="true">//  x | x | x       - | - | x</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> current_game<span class="token punctuation">.</span>host<span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> current_game<span class="token punctuation">.</span>challenger<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
         bool is_board_full <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span>uint8_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> board_len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_empty_cell</span><span class="token punctuation">(</span>current_game<span class="token punctuation">.</span>board<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               is_board_full <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>is_board_full<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">N</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token function">N</span><span class="token punctuation">(</span>none<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can see【看到】 the final tic_tac_toe.cpp here</p>
<h2 id="Creating【创建】-ABI"><a href="#Creating【创建】-ABI" class="headerlink" title="Creating【创建】 ABI"></a>Creating【创建】 ABI</h2><p>Abi (a.k.a Application【应用】 Binary【二进制】 Interface【接口】) is needed here, so the contract can understand【明白】 the action【行为】 that you send as binary【二进制】. Let’s open tic_tac_toe.abi and defines【定义】 the boilerplate here:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token punctuation">{</span>
  <span class="token string">"types"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"structs"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"base"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"actions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"ricardian_contract"</span><span class="token punctuation">:</span> <span class="token string">"..."</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"tables"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"index_type"</span><span class="token punctuation">:</span> <span class="token string">"..."</span><span class="token punctuation">,</span>
      <span class="token string">"key_names"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"key_types"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  "clauses<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
</code></pre>
<p>types【类型】: list【列出】 of types that can be represented【显示】 by another【另外】 data structure【结构】 or built-in-type (think typedef in c/c++)</p>
<p>structs【结构】: list of data structures used by the action/ table in the contract</p>
<p>actions【行为】: list of actions available in the contract<br>tables【表格】: list of tables available in the contract</p>
<h3 id="Table【表格】-ABI"><a href="#Table【表格】-ABI" class="headerlink" title="Table【表格】 ABI"></a>Table【表格】 ABI</h3><p>Remember【记住】 that in tic_tac_toe.hpp, we create【创建】 an single index i64 table called games. It stores【存储】 game structure and use challenger as the key, which data type is account_name. Hence, the abi will be:</p>
<pre class=" language-ts"><code class="language-ts"><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token string">"structs"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"game"</span><span class="token punctuation">,</span>
      <span class="token string">"base"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token string">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"challenger"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"host"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"turn"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"winner"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"board"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"uint8[]"</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token operator">...</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"tables"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"games"</span><span class="token punctuation">,</span>
        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"game"</span><span class="token punctuation">,</span>
        <span class="token string">"index_type"</span><span class="token punctuation">:</span> <span class="token string">"i64"</span><span class="token punctuation">,</span>
        <span class="token string">"key_names"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"challenger"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">"key_types"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"account_name"</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="Actions【行为】-ABI"><a href="#Actions【行为】-ABI" class="headerlink" title="Actions【行为】 ABI"></a>Actions【行为】 ABI</h3><p>For the actions, we define【定义】 the actions inside actions and the structure【结构】 of the actions inside structs.</p>
<pre class=" language-ts"><code class="language-ts"><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token string">"structs"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"create"</span><span class="token punctuation">,</span>
      <span class="token string">"base"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token string">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"challenger"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"host"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"restart"</span><span class="token punctuation">,</span>
      <span class="token string">"base"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token string">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"challenger"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"host"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"by"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"close"</span><span class="token punctuation">,</span>
      <span class="token string">"base"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token string">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"challenger"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"host"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"movement"</span><span class="token punctuation">,</span>
      <span class="token string">"base"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token string">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"row"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"uint32"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"column"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"uint32"</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"move"</span><span class="token punctuation">,</span>
      <span class="token string">"base"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token string">"fields"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"challenger"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"host"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"by"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"account_name"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"mvt"</span><span class="token punctuation">,</span> <span class="token string">"type"</span><span class="token punctuation">:</span><span class="token string">"movement"</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"actions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"create"</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"create"</span><span class="token punctuation">,</span>
      <span class="token string">"ricardian_contract"</span><span class="token punctuation">:</span> <span class="token string">""</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"restart"</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"restart"</span><span class="token punctuation">,</span>
      <span class="token string">"ricardian_contract"</span><span class="token punctuation">:</span> <span class="token string">""</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"close"</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"close"</span><span class="token punctuation">,</span>
      <span class="token string">"ricardian_contract"</span><span class="token punctuation">:</span> <span class="token string">""</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"move"</span><span class="token punctuation">,</span>
      <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"move"</span><span class="token punctuation">,</span>
      <span class="token string">"ricardian_contract"</span><span class="token punctuation">:</span> <span class="token string">""</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="Compile【编译】"><a href="#Compile【编译】" class="headerlink" title="Compile【编译】!"></a>Compile【编译】!</h3><p>Now we need to compile【编译】 tic_tac_toe.cpp to create【创建】 the tic_tac_toe.wast file that we will use to deploy【部署】 the contract into nodeos.</p>
<pre class=" language-ts"><code class="language-ts">$ eosiocpp <span class="token operator">-</span>o tic_tac_toe<span class="token punctuation">.</span>wast tic_tac_toe<span class="token punctuation">.</span>cpp
</code></pre>
<h2 id="Deploy【部署】"><a href="#Deploy【部署】" class="headerlink" title="Deploy【部署】!"></a>Deploy【部署】!</h2><p>Now the wast and abi files【文件】 (tic_tac_toe.wast and tic_tac_toe.abi) are ready. Time to deploy! Create【创建】 a directory (let’s call it tic_tac_toe) and copy【复制】 your generated【生成】 tic_tac_toe.wast tic_tac_toe.abi files.</p>
<pre class=" language-ts"><code class="language-ts">$ cleos <span class="token keyword">set</span> contract tic<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>toe tic_tac_toe
</code></pre>
<p>Ensure【保证】 that your wallet【钱包】 is unlocked and you have tic.tac.toe key imported【导入】. If you are going to upload【上传】 the contract to another【另外】 account beside tic.tac.toe, replace tic.tac.toe with your account name and ensure【保证】 you have the key for that account in your wallet</p>
<h2 id="Play【玩耍】"><a href="#Play【玩耍】" class="headerlink" title="Play【玩耍】!"></a>Play【玩耍】!</h2><p>After the deployment【部署】 and the transaction【交易】 is confirmed【确认】, the contract is already available【可用】 in the blockchain【区块链】. You can play with it now!</p>
<h3 id="Create【创建】-1"><a href="#Create【创建】-1" class="headerlink" title="Create【创建】"></a>Create【创建】</h3><pre class=" language-ts"><code class="language-ts">$ cleos push action tic<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>toe create <span class="token string">'{"challenger":"inita", "host":"initb"}'</span> <span class="token operator">--</span>permission initb@active
</code></pre>
<h3 id="Move【移动】"><a href="#Move【移动】" class="headerlink" title="Move【移动】"></a>Move【移动】</h3><pre class=" language-ts"><code class="language-ts">$ cleos push action tic<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>toe move <span class="token string">'{"challenger":"inita", "host":"initb", "by":"initb", "mvt":{"row":0, "column":0} }'</span> <span class="token operator">--</span>permission initb@active
$ cleos push action tic<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>toe move <span class="token string">'{"challenger":"inita", "host":"initb", "by":"inita", "mvt":{"row":1, "column":1} }'</span> <span class="token operator">--</span>permission inita@active
</code></pre>
<h3 id="Restart【重启】-1"><a href="#Restart【重启】-1" class="headerlink" title="Restart【重启】"></a>Restart【重启】</h3><pre class=" language-ts"><code class="language-ts">$ cleos push action tic<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>toe restart <span class="token string">'{"challenger":"inita", "host":"initb", "by":"initb"}'</span> <span class="token operator">--</span>permission initb@active
</code></pre>
<h3 id="Close【关闭】-1"><a href="#Close【关闭】-1" class="headerlink" title="Close【关闭】"></a>Close【关闭】</h3><pre class=" language-ts"><code class="language-ts">$ cleos push action tic<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>toe close <span class="token string">'{"challenger":"inita", "host":"initb"}'</span> <span class="token operator">--</span>permission initb@active
</code></pre>
<h3 id="See【看到】-the-game-status【状态】"><a href="#See【看到】-the-game-status【状态】" class="headerlink" title="See【看到】 the game status【状态】"></a>See【看到】 the game status【状态】</h3><pre class=" language-ts"><code class="language-ts">$ cleos <span class="token keyword">get</span> table tic<span class="token punctuation">.</span>tac<span class="token punctuation">.</span>toe initb games
<span class="token punctuation">{</span>
  <span class="token string">"rows"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">"challenger"</span><span class="token punctuation">:</span> <span class="token string">"inita"</span><span class="token punctuation">,</span>
      <span class="token string">"host"</span><span class="token punctuation">:</span> <span class="token string">"initb"</span><span class="token punctuation">,</span>
      <span class="token string">"turn"</span><span class="token punctuation">:</span> <span class="token string">"inita"</span><span class="token punctuation">,</span>
      <span class="token string">"winner"</span><span class="token punctuation">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>
      <span class="token string">"board"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">0</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"more"</span><span class="token punctuation">:</span> <span class="token keyword">false</span>
<span class="token punctuation">}</span>
</code></pre>

  </div>
</div>


<p class="nav-foot">
  <span class="left"><a href="/2018/06/05/online-eos-26/">« 映射</a></span>
  <span class="right"><a href="#">无 »</a></span>
</p>

<!-- 文档信息 -->
<div class="post-foot">
  <h3>文档信息</h3>
  <ul>
    <li>版权声明：自由转载-非商用-非衍生-保持署名（
      <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>）
    </li>
    <li>作者：<a href="/">Lian</a></li>
    <li>日期：2018年05月21日 20:05</li>
    <li>邮箱：lian1925@126.com</li>
  </ul>
</div>
      




<div class="content-comment">
  <h2>留言</h2>
  
  
		
</div>

<!-- 评论输入组件，填写数据：留言，称呼，电子邮件 -->

<div class="form-comment">
  <h2>
		我要发表看法
	</h2>

	<form method="post" 
	target="targetIfr"
	action="">
	 <!-- 留言正文 -->
	 
		
<p>
	<label for="comment-content">
		您的留言:
	</label>
</p>

<p>
	<textarea 
	id="comment-content" 
	name="content" 
	rows="10" cols="50">
	</textarea>
</p>

		<!-- 姓名 -->
	 
		
<p>
	<label for="comment-author">
		您的大名:
	</label>
</p>

<p>
	<input 
	id="comment-author" 
	name="author" 
	size="30" 
	value=""
	pattern="^.{2,150}$"
	required
	>
	<span class="hint">
			 «-必填
	</span
</p>


		<!-- 微信 -->
	 
		
<p>
	<label for="comment-wechat">
		您的微信:
	</label>
</p>

<p>
	<input 
	id="comment-wechat" 
	name="wechat" 
	size="30" 
	value=""
	pattern="^[a-zA-Zd_]{5,}$"
	
	>
	<span class="hint">
			 «-选填，不公开
	</span
</p>


		<!-- 电子邮箱 -->
		
		
<p>
	<label for="comment-email">
		电子邮箱：
	</label>
</p>

<p>
	<input 
	id="comment-email" 
	name="email" 
	size="30" 
	value=""
	pattern="^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(.[a-zA-Z0-9_-]+)+$"
	
	>
	<span class="hint">
			 «-选填，不公开
	</span
</p>


		
		<p>

		
<div class="button">
    <input 
    class="submit-button" 
    onclick="doButton('addComment')"
    value="发表">
    <span class="hint"> «- 点击按钮</span>
</div>
		</p>
	</form>
	<iframe name="targetIfr" style="display:none"></iframe> 
</div>


<!-- data:{
	name:'',
	type:'passwor',
	label:'您的大名',
	hint:'',
	pattern:'[A-z]{3}',
	required:"required"
} -->


<p id="info-meta" style="display:none;">
  online-eos-18
</p>


<p id="info-url" style="display:none;">
  
</p>

<div class="footer">
  Copyright @ <a href="/">lian</a> | 2009-2018
</div>

</div>

<script src="/js/jquery.js"></script>
<script src="/js/APlayer.min.js"></script>
<script src="/js/post.js"></script>

</body>

</html>

