
<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="icon" type="image/png" href="/img/sand2.png">
  <link rel="shortcut icon" type="image/x-icon" href="/img/sand2.png">
  <meta property="og:image" content="https://assets-cdn.github.com/images/modules/open_graph/github-octocat.png">
  
  <link rel="stylesheet" href="/css/style.css?v=1.3"> 
  <link href="//vjs.zencdn.net/6.7/video-js.min.css" rel="stylesheet">
  <script src="//vjs.zencdn.net/6.7/video.min.js"></script>
  
  <title>Exchange【交换】 Deposit Withdraw | 小沙丘的网络漫游记</title>
 <meta name="description" content="" >

 <!-- 百度统计 -->
 <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?eafa0040e1ab3bed28ce82ef03de6e01";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
  
<link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css"></head>
<body>
  
  <script>
      if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent)){
        document.body.classList.add('mobile');            
      } else{
        document.body.classList.add('pc');
        document.getElementsByTagName("html")[0].style.fontSize="62.5%";
      }
      var u = navigator.userAgent;
var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
if(isiOS){
  document.body.classList.add('ios');
  document.getElementsByTagName("html")[0].style.fontSize="65%";
           
}
    </script>

  <div class="container">
<!-- 用于文章页面的顶部，提供返回主页和主题页的按键 -->
<!-- 头部开始 -->

<div id="header">
    <p>小沙丘的网络漫游记
      <span> » 
        <a href="/home/">首页</a>
      </span>
      
      <span> » 
          <a href="/tags/EOS/">
            EOS
          </a>
      </span>
      
    </p>
</div>

<!-- 头部结束 -->



<!-- 分类组件，放置于文章页面的顶部，提供上(或下)一篇导航按键。 -->
<div class="asset-nav">
    <div class="entry-categories">
      <p>主题：
        <span> 
            <a href="/tags/EOS/">
              EOS
            </a>
        </span>
      </p>
    </div>
    <div class="entry-location-mobile">
        <span>
            
            <a href="/2018/05/21/online-eos-13/">
            &#8676;
            </a>
        </span>
        <span>
            
            <a href="/2018/05/21/online-eos-15/">
              &#8677;
            </a>
        </span>
    </div>
    <div class="entry-location">
        <P>上一篇：
                <a href="/2018/05/21/online-eos-13/">
                    eosio token Contract【合约】 | 教程
                </a>
        </P>
        <P>下一篇：

                <a href="/2018/05/21/online-eos-15/">
                    Hello World Contract【合约】
                </a>
        </P>
    </div>
</div>

<div class="post">
<div class="title-post">
<h1>Exchange【交换】 Deposit Withdraw</h1>
<div class="post-meta">
  <p>作者： Lian</p>
  <p>日期：
    2018年05月21日 20:05
  </p>
</div>
</div>



  
  <div class="page">
      <p>This document is targeted【目标】 toward exchanges that wish to automate【自动】 deposit and withdrawal of standard-conforming EOSIO token contracts【合约】. The blockchain’s native【本地】 token conforms【确认】 to the standard【标准】.</p>
<h2 id="Configuring【配置】-Nodeos"><a href="#Configuring【配置】-Nodeos" class="headerlink" title="Configuring【配置】 Nodeos"></a>Configuring【配置】 Nodeos</h2><p>This tutorial uses the cleos command line tool【命令行】 to query【查询】 a local nodeos server that should be connected【连接】 to an eosio blockchain. nodeos will need to be configured with the following plugins【插件】:</p>
<ul>
<li>eosio::wallet_api_plugin</li>
<li>eosio::history_api_plugin</li>
<li>eosio::chain_api_plugin</li>
</ul>
<p>By default, the history plugin will log the history of all accounts, but this is not the recommended configuration, as it will consume tens of gigabytes of RAM in the medium term. For a more optimized memory footprint, you should configure the history plugin to only log activity relevant to your account(s). This can be achieved with the following config param placed in your config.ini or passed on the command line.</p>
<pre class=" language-js"><code class="language-js">$ nodeos <span class="token operator">--</span>filter_on_accounts youraccount
</code></pre>
<h2 id="Replaying-the-Blockchain"><a href="#Replaying-the-Blockchain" class="headerlink" title="Replaying the Blockchain"></a>Replaying the Blockchain</h2><p>If you have already synced the blockchain without the history plugin, then you may need to replay the blockchain to pickup any historical activity.</p>
<pre class=" language-js"><code class="language-js">$ nodeos <span class="token operator">--</span>replay <span class="token operator">--</span>filter_on_accounts youraccount
</code></pre>
<p>You only need to replay once. Subsequent runs of nodeos should not use the replay flag, as your startup times will be unnecessarily long.</p>
<h2 id="Accepting-Deposits"><a href="#Accepting-Deposits" class="headerlink" title="Accepting Deposits"></a>Accepting Deposits</h2><p>When designing this tutorial, we assume that an exchange will poll nodeos for incoming transactions and will want to know when a transfer is considered irreversible or final.</p>
<p>With eosio-based chains, finality of a transaction occurs once 2/3 + 1 of block producers have either directly or indirectly confirmed the block. This could take from less than a second to a couple of minutes, but either way nodeos will keep you posted on the status.</p>
<h2 id="Initial-Condition"><a href="#Initial-Condition" class="headerlink" title="Initial Condition"></a>Initial Condition</h2><pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> currency balance eosio<span class="token punctuation">.</span>token scott SYS
<span class="token number">900.0000</span> SYS
</code></pre>
<p>We will now deposit some funds to exchange:</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos transfer scott exchange <span class="token string">"1.0000 SYS"</span> deposit
executed transaction<span class="token punctuation">:</span> 5ec797175dd24612acd8fc5a8685fa44caa8646cec0a87b12568db22a3df02fb  <span class="token number">256</span> bytes  8k cycles
#   eosio<span class="token punctuation">.</span>token <span class="token operator">&lt;=</span> eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer        <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span><span class="token string">"memo"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
<span class="token operator">></span><span class="token operator">></span> transfer
#         scott <span class="token operator">&lt;=</span> eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer        <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span><span class="token string">"memo"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
#      exchange <span class="token operator">&lt;=</span> eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer        <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span><span class="token string">"memo"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>
warning<span class="token punctuation">:</span> transaction executed locally<span class="token punctuation">,</span> but may not be confirmed by the network yet
</code></pre>
<p>This output indicates that the action eosio.token::transfer was delivered to three accounts/contracts, (“eosio.token”, “scott”, and “exchange”). The eosio token standard requires that both the sender and receiver account/contract be notified of all transfer actions so that those accounts can run custom logic. At this time, neither scott nor exchange has any contract set, but the transaction log still notes that they were notified.</p>
<h2 id="Polling-Account-History"><a href="#Polling-Account-History" class="headerlink" title="Polling Account History"></a>Polling Account History</h2><p>The account history consists of all actions that were either authorized by the account or received by the account. Since the exchange received the eosio.token::transfer action, it is listed in the history. If you are using the console, confirmed and irreversible transactions are printed in “green” while unconfirmed transactions are printed in “yellow”. Without color, you can tell whether a transaction is confirmed or not by the first character: ‘#’ for irreversible and ‘?’ for potentially reversible.</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> actions exchange
#  seq  when                              contract<span class="token punctuation">:</span><span class="token punctuation">:</span>action <span class="token operator">=</span><span class="token operator">></span> receiver      trx id<span class="token operator">...</span>   args
<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>
#    <span class="token number">0</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">45.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      5ec79717<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
Do a few more transfers<span class="token punctuation">:</span>

<span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> actions exchange
#  seq  when                              contract<span class="token punctuation">:</span><span class="token punctuation">:</span>action <span class="token operator">=</span><span class="token operator">></span> receiver      trx id<span class="token operator">...</span>   args
<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>
#    <span class="token number">0</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">45.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      5ec79717<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
#    <span class="token number">1</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">25.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      2269828c<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
<span class="token operator">?</span>    <span class="token number">2</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      213f3797<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
</code></pre>
<p>The last transfer is still pending, waiting on irreversibility.</p>
<p>The “seq” column represents the index of actions for your specific account. It will always increment as new relevant actions are added.</p>
<p>The cleos get actions command allows you some control over which actions are fetched. You can view the help for this command with -h</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> actions <span class="token operator">-</span>h
Usage<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> actions <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> account_name <span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token punctuation">[</span>offset<span class="token punctuation">]</span>

Positionals<span class="token punctuation">:</span>
  account_name TEXT           name <span class="token keyword">of</span> account to query on
  pos INT                     sequence number <span class="token keyword">of</span> action <span class="token keyword">for</span> <span class="token keyword">this</span> account<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">for</span> last
  offset INT                  <span class="token keyword">get</span> actions <span class="token punctuation">[</span>pos<span class="token punctuation">,</span>pos<span class="token operator">+</span>offset<span class="token punctuation">]</span> <span class="token keyword">for</span> positive offset or <span class="token punctuation">[</span>pos<span class="token operator">-</span>offset<span class="token punctuation">,</span>pos<span class="token punctuation">)</span> <span class="token keyword">for</span> negative offset

  Options<span class="token punctuation">:</span>
    <span class="token operator">-</span>j<span class="token punctuation">,</span><span class="token operator">--</span>json                   print full json
    <span class="token operator">--</span>full                      don't truncate action json
    <span class="token operator">--</span>pretty                    pretty print full action json
    <span class="token operator">--</span>console                   print console output generated by action
</code></pre>
<p>To get only the last action you would do the following:</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> actions exchange <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">1</span>
#  seq  when                              contract<span class="token punctuation">:</span><span class="token punctuation">:</span>action <span class="token operator">=</span><span class="token operator">></span> receiver      trx id<span class="token operator">...</span>   args
<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>
#    <span class="token number">2</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      213f3797<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
</code></pre>
<p>This command says to go to the last sequence number (indicated by pos = -1) and then fetch “1” item prior to it (offset = -1). Using the example above, this will return a sequence in the range [3-1,3) or [2,3) which is only row 2. In this case, “-1” position means “one past the last sequence” and operates like an end iterator from C++ containers.</p>
<h2 id="Fetching-only-“New”-Actions"><a href="#Fetching-only-“New”-Actions" class="headerlink" title="Fetching only “New” Actions"></a>Fetching only “New” Actions</h2><p>Since we presume your exchange is running a polling micro-service, it will want to fetch the “next unprocessed deposit”. In this case the microservice will need to track the seq number of the “last processed seq”. For the sake of this example, we will assume that “seq 0” has been processed and that we want to fetch “seq 1” if any.</p>
<p>We pass pos=1 and offset=0 to get the range [1,1+0] or [1,1].</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> actions exchange <span class="token number">1</span> <span class="token number">0</span>
#  seq  when                              contract<span class="token punctuation">:</span><span class="token punctuation">:</span>action <span class="token operator">=</span><span class="token operator">></span> receiver      trx id<span class="token operator">...</span>   args
<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>
#    <span class="token number">1</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">25.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      2269828c<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
</code></pre>
<p>We can call this in a loop, processing each confirmed action (those starting with #) until we either run out of items or we find an unconfirmed action (starting with ?).</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> actions exchange <span class="token number">3</span> <span class="token number">0</span>
#  seq  when                              contract<span class="token punctuation">:</span><span class="token punctuation">:</span>action <span class="token operator">=</span><span class="token operator">></span> receiver      trx id<span class="token operator">...</span>   args
<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>
</code></pre>
<h2 id="Machine-Readable-Account-History-JSON"><a href="#Machine-Readable-Account-History-JSON" class="headerlink" title="Machine Readable Account History (JSON)"></a>Machine Readable Account History (JSON)</h2><p>So far this tutorial has focused on using cleos to fetch and display the history. However, cleos is merely a light-weight wrapper around a JSON-RPC interface. cleos can dump the raw json returned from the JSON-RPC request, or you can make your own JSON-RPC request.</p>
<p>Here is the JSON returned when querying sequence 2.</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> actions exchange <span class="token number">2</span> <span class="token number">0</span> <span class="token operator">-</span>j
<span class="token punctuation">{</span>
  <span class="token string">"actions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token string">"global_action_seq"</span><span class="token punctuation">:</span> <span class="token number">32856</span><span class="token punctuation">,</span>
      <span class="token string">"account_action_seq"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token string">"block_num"</span><span class="token punctuation">:</span> <span class="token number">32759</span><span class="token punctuation">,</span>
      <span class="token string">"block_time"</span><span class="token punctuation">:</span> <span class="token string">"2018-04-29T01:19:54.000"</span><span class="token punctuation">,</span>
      <span class="token string">"action_trace"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">"receipt"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token string">"receiver"</span><span class="token punctuation">:</span> <span class="token string">"exchange"</span><span class="token punctuation">,</span>
          <span class="token string">"act_digest"</span><span class="token punctuation">:</span> <span class="token string">"00686ff415fe97951a942889dbaed2b880043e3ae6ac2d5579318bbb2d30060f"</span><span class="token punctuation">,</span>
          <span class="token string">"global_sequence"</span><span class="token punctuation">:</span> <span class="token number">32856</span><span class="token punctuation">,</span>
          <span class="token string">"recv_sequence"</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token string">"auth_sequence"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
              <span class="token string">"scott"</span><span class="token punctuation">,</span>
              <span class="token number">43</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"act"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token string">"account"</span><span class="token punctuation">:</span> <span class="token string">"eosio.token"</span><span class="token punctuation">,</span>
          <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"transfer"</span><span class="token punctuation">,</span>
          <span class="token string">"authorization"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
              <span class="token string">"actor"</span><span class="token punctuation">:</span> <span class="token string">"scott"</span><span class="token punctuation">,</span>
              <span class="token string">"permission"</span><span class="token punctuation">:</span> <span class="token string">"active"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token string">"data"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">"from"</span><span class="token punctuation">:</span> <span class="token string">"scott"</span><span class="token punctuation">,</span>
            <span class="token string">"to"</span><span class="token punctuation">:</span> <span class="token string">"exchange"</span><span class="token punctuation">,</span>
            <span class="token string">"quantity"</span><span class="token punctuation">:</span> <span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>
            <span class="token string">"memo"</span><span class="token punctuation">:</span> <span class="token string">""</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">"hex_data"</span><span class="token punctuation">:</span> <span class="token string">"00000000809c29c20000008a4dd35057102700000000000004454f530000000000"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">"elapsed"</span><span class="token punctuation">:</span> <span class="token number">52</span><span class="token punctuation">,</span>
        <span class="token string">"cpu_usage"</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token string">"console"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string">"total_inline_cpu_usage"</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token string">"trx_id"</span><span class="token punctuation">:</span> <span class="token string">"213f37972498cbae5abf6bcb5aec82e09967df7f04cf90f67b7d63a6bb871d58"</span><span class="token punctuation">,</span>
        <span class="token string">"inline_traces"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"last_irreversible_block"</span><span class="token punctuation">:</span> <span class="token number">35062</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Given this JSON, an action is irreversible (final) if “block_num” &lt; “last_irreversible_block”.</p>
<p>You can identify irreversible deposits by the following:</p>
<pre class=" language-js"><code class="language-js">    actions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>action_trace<span class="token punctuation">.</span>act<span class="token punctuation">.</span>account <span class="token operator">==</span> <span class="token string">"eosio.token"</span> <span class="token operator">&amp;&amp;</span>
    actions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>action_trace<span class="token punctuation">.</span>act<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">"transfer"</span> <span class="token operator">&amp;&amp;</span>
    actions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>action_trace<span class="token punctuation">.</span>act<span class="token punctuation">.</span>data<span class="token punctuation">.</span>quantity <span class="token operator">==</span> <span class="token string">"X.0000 SYS"</span> <span class="token operator">&amp;&amp;</span>
    actions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>action_trace<span class="token punctuation">.</span>to <span class="token operator">==</span> <span class="token string">"exchange"</span> <span class="token operator">&amp;&amp;</span> 
    actions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>action_trace<span class="token punctuation">.</span>memo <span class="token operator">==</span> <span class="token string">"KEY TO IDENTIFY INTERNAL ACCOUNT"</span> <span class="token operator">&amp;&amp;</span> 
    actions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>action_trace<span class="token punctuation">.</span>receipt<span class="token punctuation">.</span>receiver <span class="token operator">==</span> <span class="token string">"exchange"</span>  <span class="token operator">&amp;&amp;</span>
    actions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>block_num <span class="token operator">&lt;</span> last_irreversible_block
</code></pre>
<p>In practice you should give your customers a “memo” that identifies which of your internal accounts you should credit with the deposit.</p>
<h2 id="WARNING"><a href="#WARNING" class="headerlink" title="WARNING"></a>WARNING</h2><p>It is critical that you validate all of the conditions above, including the token symbol name. Users can create other contracts with “transfer” actions that “notify” your account. If you do not validate all of the above properties, then you may process “false deposits”.</p>
<pre class=" language-js"><code class="language-js">    actions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>action_trace<span class="token punctuation">.</span>act<span class="token punctuation">.</span>account <span class="token operator">==</span> <span class="token string">"eosio.token"</span> <span class="token operator">&amp;&amp;</span>
    actions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>action_trace<span class="token punctuation">.</span>receipt<span class="token punctuation">.</span>receiver <span class="token operator">==</span> <span class="token string">"exchange"</span>
</code></pre>
<h2 id="Validating-Balance"><a href="#Validating-Balance" class="headerlink" title="Validating Balance"></a>Validating Balance</h2><p>Now that we have received three deposits, we should see that the exchange has a balance of 3.0000 SYS.</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> currency balance eosio<span class="token punctuation">.</span>token exchange SYS
<span class="token number">3.0000</span> SYS
</code></pre>
<h2 id="Processing-Withdrawals"><a href="#Processing-Withdrawals" class="headerlink" title="Processing Withdrawals"></a>Processing Withdrawals</h2><p>(Note: while generating this tutorial, scott deposited another 1.0000 SYS (seq 3) for a total exchange balance of 4.0000 SYS.)</p>
<p>When a user requests a withdrawal from your exchange, they will need to provide you with their eosio account name and the amount to be withdrawn. You can then run the cleos command to perform the withdrawal. cleos will interact with the “unlocked” wallet running on nodeos, which should only enable localhost connections. More advanced usage will have a separate key-server (keosd), but that will be covered later.</p>
<p>Let’s assume scott wants to withdraw 1.0000 SYS:</p>
<pre class=" language-JS"><code class="language-JS">./cleos transfer exchange scott  "1.0000 SYS"
executed transaction: 93e785202e7502bb1383ad10e786cc20f7dd738d3fd3da38712b3fb38fb9af26  256 bytes  8k cycles
#   eosio.token <= eosio.token::transfer        {"from":"exchange","to":"scott","quantity":"1.0000 SYS","memo":""}
>> transfer
#      exchange <= eosio.token::transfer        {"from":"exchange","to":"scott","quantity":"1.0000 SYS","memo":""}
#         scott <= eosio.token::transfer        {"from":"exchange","to":"scott","quantity":"1.0000 SYS","memo":""}
warning: transaction executed locally, but may not be confirmed by the network yet
</code></pre>
<p>At this stage your local nodeos client accepted the transaction and likely broadcast it to the broader network.</p>
<p>We can get the history and see that there are “3” new actions listed, all with transaction id 93e78520…, as reported by our transfer command. Because exchange authorized the transaction, it is informed of all accounts that processed and accepted the transfer. In this case the eosio.token contract processed the transfer and updated balances, the sender (exchange) processed it, as did the receiver (scott). All three contracts/accounts approved it and/or performed state transitions based upon the action.</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> actions exchange <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">-</span><span class="token number">8</span>
#  seq  when                              contract<span class="token punctuation">:</span><span class="token punctuation">:</span>action <span class="token operator">=</span><span class="token operator">></span> receiver      trx id<span class="token operator">...</span>   args
<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">=</span>
#    <span class="token number">0</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">45.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      5ec79717<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
#    <span class="token number">1</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">25.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      2269828c<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
#    <span class="token number">2</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">54.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      213f3797<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
#    <span class="token number">3</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">53</span><span class="token punctuation">:</span><span class="token number">57.000</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      8b7766ac<span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
#    <span class="token number">4</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">17.500</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> eosio<span class="token punctuation">.</span>token   <span class="token number">93e78520</span><span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
#    <span class="token number">5</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">17.500</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> exchange      <span class="token number">93e78520</span><span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
#    <span class="token number">6</span>   <span class="token number">2018</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span>29T01<span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">17.500</span>     eosio<span class="token punctuation">.</span>token<span class="token punctuation">:</span><span class="token punctuation">:</span>transfer <span class="token operator">=</span><span class="token operator">></span> scott         <span class="token number">93e78520</span><span class="token operator">...</span> <span class="token punctuation">{</span><span class="token string">"from"</span><span class="token punctuation">:</span><span class="token string">"exchange"</span><span class="token punctuation">,</span><span class="token string">"to"</span><span class="token punctuation">:</span><span class="token string">"scott"</span><span class="token punctuation">,</span><span class="token string">"quantity"</span><span class="token punctuation">:</span><span class="token string">"1.0000 SYS"</span><span class="token punctuation">,</span>"mem<span class="token operator">...</span>
</code></pre>
<p>By processing the history, we can be informed when our transaction was confirmed. In practice, we expect you will maintain private database state to track the withdrawal process. It might be useful to embed an exchange-specific memo in the withdraw request in order to map to your private database state. Another approach is to simply use the transaction ID for your mapping. When your account history microservice comes across seq 5 and sees it is irreversible, it can then mark your withdrawal as complete.</p>
<h2 id="Handling-Errors"><a href="#Handling-Errors" class="headerlink" title="Handling Errors"></a>Handling Errors</h2><p>Sometimes network issues will cause a transaction to fail and never be included in a block. Your internal database will need to know when this has happened so that it can inform the user and/or try again. If you do not get an immediate error when you submit your local transfer, then you must wait for the transaction to expire. Every transaction has an “expiration”, after which the transaction can never be applied. Once the last irreversible block has moved past the expiration time, you can safely mark your attempted withdrawal as failed and not worry about it “floating around the ether” to be applied when you least expect.</p>
<p>By default, cleos sets an expiration window of 2 minutes. This is long enough to allow all 21 producers an opportunity to include the transaction.</p>
<pre class=" language-js"><code class="language-js"> <span class="token punctuation">.</span><span class="token operator">/</span>cleos transfer exchange scott  <span class="token string">"1.0000 SYS"</span> <span class="token operator">-</span>j <span class="token operator">-</span>d
<span class="token punctuation">{</span>
  <span class="token string">"expiration"</span><span class="token punctuation">:</span> <span class="token string">"2018-04-29T01:58:12"</span><span class="token punctuation">,</span>
  <span class="token string">"ref_block_num"</span><span class="token punctuation">:</span> <span class="token number">37282</span><span class="token punctuation">,</span>
  <span class="token string">"ref_block_prefix"</span><span class="token punctuation">:</span> <span class="token number">351570603</span><span class="token punctuation">,</span>
  <span class="token string">"max_net_usage_words"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"max_kcpu_usage"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"delay_sec"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token string">"context_free_actions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
</code></pre>
<p>Your microservice can query the last irreversible block number and the head block time using cleos.</p>
<pre class=" language-js"><code class="language-js"><span class="token punctuation">.</span><span class="token operator">/</span>cleos <span class="token keyword">get</span> info
<span class="token punctuation">{</span>
  <span class="token string">"server_version"</span><span class="token punctuation">:</span> <span class="token string">"0812f84d"</span><span class="token punctuation">,</span>
  <span class="token string">"head_block_num"</span><span class="token punctuation">:</span> <span class="token number">39313</span><span class="token punctuation">,</span>
  <span class="token string">"last_irreversible_block_num"</span><span class="token punctuation">:</span> <span class="token number">39298</span><span class="token punctuation">,</span>
  <span class="token string">"last_irreversible_block_id"</span><span class="token punctuation">:</span> <span class="token string">"000099823bfc4f0b936d8e48c70fc3f1619eb8d21989d160a9fe23655f1f5c79"</span><span class="token punctuation">,</span>
  <span class="token string">"head_block_id"</span><span class="token punctuation">:</span> <span class="token string">"000099912473a7a3699ad682f731d1874ebddcf4b60eff79f8e6e4216077278d"</span><span class="token punctuation">,</span>
  <span class="token string">"head_block_time"</span><span class="token punctuation">:</span> <span class="token string">"2018-04-29T02:14:31"</span><span class="token punctuation">,</span>
  <span class="token string">"head_block_producer"</span><span class="token punctuation">:</span> <span class="token string">"producer2"</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="Exchange-Security"><a href="#Exchange-Security" class="headerlink" title="Exchange Security"></a>Exchange Security</h2><p>This tutorial shows the minimal viable deposit/withdraw handlers and assumes a single wallet which contains all keys necessary to authorize deposits and withdrawals. A security-focused exchange would take the following additional steps:</p>
<p>keep vast majority of funds in a time-delayed, multi-sig controlled account</p>
<p>use multi-sig on the hot wallet with several independent processes/servers double-checking all withdrawals</p>
<p>deploy a custom contract that only allows withdrawals to KYC’d accounts and require multi-sig to white-list accounts</p>
<p>deploy a custom contract that only accepts deposits of known tokens from KYC’d accounts</p>
<p>deploy a custom contract that enforces a mandatory 24-hour waiting period for all withdrawals</p>
<p>utilize hardware wallets for all signing, even automated withdrawal</p>
<p>Customers want immediate withdrawals, but they also want the exchange to be protected. The blockchain-enforced 24-hour period lets the customer know the money is “on the way” while also informing potential-hackers that the exchange has 24 hours to respond to unauthorized access. Furthermore, if the exchange emails/text messages users upon start of withdrawal, users have 24 hours to contact the exchange and fix any unauthorized access to their individual account.</p>
<p>Information on how to utilize these more advanced techniques will be available in a future document.</p>

  </div>
</div>


<p class="nav-foot">
  <span class="left"><a href="/2018/05/21/online-eos-13/">« eosio toke...</a></span>
  <span class="right"><a href="/2018/05/21/online-eos-15/">Hello Worl... »</a></span>
</p>

<!-- 文档信息 -->
<div class="post-foot">
  <h3>文档信息</h3>
  <ul>
    <li>版权声明：自由转载-非商用-非衍生-保持署名（
      <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>）
    </li>
    <li>作者：<a href="/">Lian</a></li>
    <li>日期：2018年05月21日 20:05</li>
    <li>邮箱：lian1925@126.com</li>
  </ul>
</div>
      




<div class="content-comment">
  <h2>留言</h2>
  
  
		
</div>

<!-- 评论输入组件，填写数据：留言，称呼，电子邮件 -->

<div class="form-comment">
  <h2>
		我要发表看法
	</h2>

	<form method="post" 
	target="targetIfr"
	action="">
	 <!-- 留言正文 -->
	 
		
<p>
	<label for="comment-content">
		您的留言:
	</label>
</p>

<p>
	<textarea 
	id="comment-content" 
	name="content" 
	rows="10" cols="50">
	</textarea>
</p>

		<!-- 姓名 -->
	 
		
<p>
	<label for="comment-author">
		您的大名:
	</label>
</p>

<p>
	<input 
	id="comment-author" 
	name="author" 
	size="30" 
	value=""
	pattern="^.{2,150}$"
	required
	>
	<span class="hint">
			 «-必填
	</span
</p>


		<!-- 微信 -->
	 
		
<p>
	<label for="comment-wechat">
		您的微信:
	</label>
</p>

<p>
	<input 
	id="comment-wechat" 
	name="wechat" 
	size="30" 
	value=""
	pattern="^[a-zA-Zd_]{5,}$"
	
	>
	<span class="hint">
			 «-选填，不公开
	</span
</p>


		<!-- 电子邮箱 -->
		
		
<p>
	<label for="comment-email">
		电子邮箱：
	</label>
</p>

<p>
	<input 
	id="comment-email" 
	name="email" 
	size="30" 
	value=""
	pattern="^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(.[a-zA-Z0-9_-]+)+$"
	
	>
	<span class="hint">
			 «-选填，不公开
	</span
</p>


		
		<p>

		
<div class="button">
    <input 
    class="submit-button" 
    onclick="doButton('addComment')"
    value="发表">
    <span class="hint"> «- 点击按钮</span>
</div>
		</p>
	</form>
	<iframe name="targetIfr" style="display:none"></iframe> 
</div>


<!-- data:{
	name:'',
	type:'passwor',
	label:'您的大名',
	hint:'',
	pattern:'[A-z]{3}',
	required:"required"
} -->


<p id="info-meta" style="display:none;">
  online-eos-14
</p>


<p id="info-url" style="display:none;">
  
</p>

<div class="footer">
  Copyright @ <a href="/">lian</a> | 2009-2018
</div>

</div>

<script src="/js/jquery.js"></script>
<script src="/js/APlayer.min.js"></script>
<script src="/js/post.js"></script>

</body>

</html>

